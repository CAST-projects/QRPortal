{
    "id": 7636,
    "name": "Prefer using version number instead of timestamp for Hibernate Entity",
    "href": "AIP/quality-rules/7636",
    "critical": false,
    "maxWeight": 7,
    "description": "Using the version attribute or timestamp instructs Hibernate that we would like to use an optimistic locking mechanism.\nBut the usage of timestamp is slightly less safe and a little less reliable than a version number. This is because of the following drawbacks of using Timestamp, \n1. The JVM usually doesn\u2019t provide the timestamp with millisecond accuracy.\n2. Hibernate can\u2019t detect 2 concurrent updates that are executed at the same millisecond.\n3. If you scale your application horizontally, you need to keep the timestamp of all instances in sync\n\n\n\nThis rule reports all hibernate entities that use timestamp property instead of version number.",
    "output": "The metric will list all hibernate entities that use timestamp property instead of version.\n\nIt provides the following information:\n Hibernate Entity",
    "rationale": "If the Hibernate application is on different systems that are not time-synchronized, the timestamp generated by each system might be different thereby generating improper optimistic lock success or failures.\nIf your timestamp data type doesn't include a daylight saving time attribute, you'll run into problems with Hibernate's automatic versioning. The version property is less problematic for automatic versioning; hence we recommend it.",
    "reference": "Hibernate in Action (ISBN 1932394-15-X) p 169 & 391",
    "remediation": "Use version attribute as a control.",
    "remediationSample": "Remdiation 1\n<class name=\"Sample\" table=\"SAMPLE\">\n   <id ...../>\n   <version name=\"version\" column=\"VERSION\"/> // FIXED\n...\n</class>\n\n------------------------------------------------\nRemediation 2\n\n@Entity(name = \"Phone\")\npublic static class Phone {\n\n    @Id\n    private Long id;\n\n    @Column(name = \"`number`\")\n    private String number;\n\n    @Version //Fixed\n    private Long version;\n}",
    "sample": "Sample 1\n<class name=\"Sample\" table=\"SAMPLE\">\n   <id ...../>\n   <timestamp name=\"lastUpdated\" column=\"LAST_UPDATED\"/> // VIOLATION\n...\n</class>\n--------------------------------------\nSample 2\n\n//Timestamping is automatically used if you the @Version annotation on a Date or Calendar\n@Entity\npublic class Flight implements Serializable {\n...\n    @Version //Violation\n    public Date getLastUpdate() { ... }\n}\n\nor \n\n@Entity(name = \"Person\")\npublic static class Person {\n\n    @Id\n    private Long id;\n\n    private String firstName;\n\n    private String lastName;\n\n    @Version                    //Violation\n    @Source(value = SourceType.DB)\n    private Date version;\n}\n--------------------------------------------------------------------------------------------",
    "total": "Number of Hibernate entities that use version or timestamp property",
    "alternativeName": "Ensure to use version attribute instead of timestamp for Hibernate Entity",
    "businessCriteria": [
        {
            "id": 20140522,
            "name": "GreenIT-Index",
            "href": "AIP/business-criteria/20140522"
        },
        {
            "id": 66031,
            "name": "Programming Practices",
            "href": "AIP/business-criteria/66031"
        },
        {
            "id": 60013,
            "name": "Robustness",
            "href": "AIP/business-criteria/60013"
        },
        {
            "id": 60016,
            "name": "Security",
            "href": "AIP/business-criteria/60016"
        },
        {
            "id": 60017,
            "name": "Total Quality Index",
            "href": "AIP/business-criteria/60017"
        }
    ],
    "technicalCriteria": [
        {
            "id": 66065,
            "name": "Secure Coding - Time and State",
            "href": "AIP/technical-criteria/66065",
            "weight": 7
        }
    ],
    "technologies": [
        {
            "id": 140029,
            "name": "JEE",
            "href": "AIP/technologies/140029"
        }
    ],
    "qualityStandards": [
        
    ],
    "parameters": [
        
    ],
    "thresholds": [
        98.0,
        99.0,
        99.5,
        99.99
    ]
}
