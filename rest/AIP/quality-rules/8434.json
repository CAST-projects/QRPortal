{
    "id": 8434,
    "name": "Avoid process control",
    "href": "AIP/quality-rules/8434",
    "critical": true,
    "severity": 30,
    "maxWeight": 9,
    "extension": {
        "name": "com.castsoftware.securityanalyzer",
        "href": "AIP/extensions/com.castsoftware.securityanalyzer"
    },
    "associatedValueName": "Call stack from user input source down to the target library loading",
    "description": "Using CAST data-flow engine, this quality rule identifies code paths where user-controlled input flows directly to system call API methods that can load libraries. The rule tracks data flow from untrusted user input sources down to sensitive library loading functions.\nThis quality rule focuses specifically on preventing unauthorized library loading by detecting when user input can influence which libraries or assemblies are loaded into the application's process space.",
    "output": "List all methods that make resource calls forged by user input\n\nIt provides the following information:\n - Method full name\n - Call stack from user input source down to the target file path command method.",
    "rationale": "When user input directly influences library loading operations, attackers can inject malicious library names or paths to:\n-Load malicious libraries that compromise application security\n-Execute arbitrary code through malicious dynamic libraries (DLLs, shared objects)\n-Bypass security controls by loading unauthorized modules\n-Gain elevated privileges through library injection attacks\n-Access sensitive system resources through crafted library paths\nThis vulnerability is particularly dangerous because loaded libraries execute with the same privileges as the host application. Attackers can exploit path traversal vulnerabilities (e.g., \"../../../malicious.dll\") or inject completely different library names to load malicious code. The impact ranges from information disclosure to complete system compromise, as malicious libraries can hook into application functions and intercept sensitive operations.",
    "reference": "CWE-114: Process Control\nhttps://cwe.mitre.org/data/definitions/114.html\n\nCWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')\nhttps://cwe.mitre.org/data/definitions/78.html\n\nOpen Web Application Security Project (OWASP) - OWASP Top 10:2021\nhttps://owasp.org/Top10/fr/A03_2021-Injection/\n\nCISQ: ASCSM-CWE-078",
    "remediation": "Avoid using inputs. If it is not possible:\n-Input validation: implement strict whitelist validation allowing only known-good library identifiers\n-Path restriction: use only predefined library paths and validate against directory traversal\n-Library mapping: map user input to predefined library names through configuration\n-Path canonicalization: resolve and validate library paths before loading",
    "remediationSample": "Avoid paths being concatenated with user inputs.\nIf this is not possible, validate the arguments using a dedicated method and declare this method as a sanitization method for the quality rule. Example of such methods:\n\n// ----------------------------------------------------------------------------\n// 1) Java sample\n\npublic static void loadLibrary_secure(String libName) {\n  String libPath = getSecureLibraryPath(libName);\n  if (libPath != null) {\n    System.loadLibrary(libPath);  // \u2713 OK\n  }\n}\n\nprivate static String getSecureLibraryPath(String libName) {\n  final Map<String, String> ALLOWED_LIBS = Map.of(\n      \"mylib\", \"/usr/local/libs/mylib.so\",\n      \"otherlib\", \"/usr/local/libs/otherlib.so\"\n  );\n  String path = ALLOWED_LIBS.get(libName);\n  if (path != null) {\n    return path;\n  } else {\n    System.err.println(\"Invalid library specified.\");\n    return null;\n  }\n}\n\n\n// ----------------------------------------------------------------------------\n// 2) C# sample\n\nprivate static bool LoadLibrary_secure(string libName)\n{\n  // Validate and get secure the library path\n  string securePath = GetSecureLibraryPath(libName);\n  if (securePath == null)\n  {\n    return false;\n  }\n\n  if (!System.IO.File.Exists(securePath))\n  {\n    return false;\n  }\n\n  NativeLibrary.Load(securePath); // \u2713 OK\n  return true;\n}\n\nprivate static string GetSecureLibraryPath(string libName)\n{\n  Dictionary<string, string> AllowedLibs = new()\n  {\n    [\"mylib\"] = \"C:\\\\libs\\\\mylib.dll\",\n    [\"otherlib\"] = \"C:\\\\libs\\\\otherlib.dll\"\n  };\n\n  // White-list + absolute path\n  if (AllowedLibs.TryGetValue(libName, out var path))\n  {\n    return path;\n  }\n  else\n  {\n    Console.Error.WriteLine(\"Invalid library specified.\");\n    return null;\n  }\n}",
    "sample": "// ----------------------------------------------------------------------------\n// 1) Java sample\n\npublic class Main {\n\n  public static void loadLibrary_unsecure(String libName) {\n    System.loadLibrary(libName);  // \u26a0\ufe0f Vulnerability\n  }\n\n  public static void main(String[] args) {\n    if (args.length > 0) {\n      String libName = args[0];  // Unsafe input\n      loadLibrary_unsecure(libName);\n    }\n  }\n}\n\n\n// ----------------------------------------------------------------------------\n// 2) C# sample\n\nusing System;\nusing System.Runtime.InteropServices;\n\ninternal class Program\n{\n  private static bool LoadLibrary_unsecure(string libName)\n  {\n    NativeLibrary.Load(libName); // \u26a0\ufe0f Vulnerability\n    return true;\n  }\n\n\n  static void Main(string[] args)\n  {\n    if (args.Length > 0)\n    {\n      string libName = args[0]; // Unsafe input\n      LoadLibrary_unsecure(libName);\n    }\n  }\n}",
    "total": "Number of potentially vulnerable methods",
    "alternativeName": "Ensure you don't use external library given by unsanitized user input",
    "businessCriteria": [
        {
            "id": 1062100,
            "name": "CISQ-Index",
            "href": "AIP/business-criteria/1062100"
        },
        {
            "id": 1061000,
            "name": "ISO-5055-Index",
            "href": "AIP/business-criteria/1061000"
        },
        {
            "id": 66031,
            "name": "Programming Practices",
            "href": "AIP/business-criteria/66031"
        },
        {
            "id": 60016,
            "name": "Security",
            "href": "AIP/business-criteria/60016"
        }
    ],
    "technicalCriteria": [
        {
            "id": 1062189,
            "name": "ASCSM-CWE-78 - OS Command Injection Improper Input Neutralization",
            "href": "AIP/technical-criteria/1062189",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1066214,
            "name": "CWE-114 - Process Control",
            "href": "AIP/technical-criteria/1066214",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1061014,
            "name": "CWE-78 - Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')",
            "href": "AIP/technical-criteria/1061014",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1066178,
            "name": "CWE-78 - Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')",
            "href": "AIP/technical-criteria/1066178",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1061016,
            "name": "CWE-88 - Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
            "href": "AIP/technical-criteria/1061016",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1066188,
            "name": "CWE-88 - Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
            "href": "AIP/technical-criteria/1066188",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1062301,
            "name": "OWASP-2013-A1 - Injection",
            "href": "AIP/technical-criteria/1062301",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1062321,
            "name": "OWASP-2017-A1 - Injection",
            "href": "AIP/technical-criteria/1062321",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1062343,
            "name": "OWASP-2021-A03 - Injection",
            "href": "AIP/technical-criteria/1062343",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1063155,
            "name": "PCI-DSS4-Requirement-6.2.4 - Software engineering techniques or other methods are defined and in use by software development personnel to prevent or mitigate common software attacks and related vulnerabilities",
            "href": "AIP/technical-criteria/1063155",
            "weight": 5,
            "critical": false
        },
        {
            "id": 1063114,
            "name": "PCI-Requirement-6.5.1 - Injection flaws, particularly SQL injection",
            "href": "AIP/technical-criteria/1063114",
            "weight": 5,
            "critical": false
        },
        {
            "id": 66062,
            "name": "Secure Coding - Input Validation",
            "href": "AIP/technical-criteria/66062",
            "weight": 9,
            "critical": true
        }
    ],
    "technologies": [
        {
            "id": 138383,
            "name": "C#",
            "href": "AIP/technologies/138383"
        },
        {
            "id": 140029,
            "name": "JEE",
            "href": "AIP/technologies/140029"
        },
        {
            "id": 138385,
            "name": "VB.NET",
            "href": "AIP/technologies/138385"
        }
    ],
    "qualityStandards": [
        {
            "id": "AIP-CWE-78",
            "name": "Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')",
            "href": "AIP/quality-standards/AIP-STRUCTURAL-FLAW/items/AIP-CWE-78",
            "standard": "AIP-STRUCTURAL-FLAW"
        },
        {
            "id": "ASCSM-CWE-78",
            "name": "OS Command Injection Improper Input Neutralization",
            "href": "AIP/quality-standards/CISQ/items/ASCSM-CWE-78",
            "standard": "CISQ"
        },
        {
            "id": "CWE-78",
            "name": "Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')",
            "href": "AIP/quality-standards/CWE/items/CWE-78",
            "standard": "CWE"
        },
        {
            "id": "CWE-88",
            "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
            "href": "AIP/quality-standards/CWE/items/CWE-88",
            "standard": "CWE"
        },
        {
            "id": "CWE-114",
            "name": "Process Control",
            "href": "AIP/quality-standards/CWE/items/CWE-114",
            "standard": "CWE"
        },
        {
            "id": "CWE-78",
            "name": "Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')",
            "href": "AIP/quality-standards/ISO-5055/items/CWE-78",
            "standard": "ISO-5055"
        },
        {
            "id": "CWE-88",
            "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
            "href": "AIP/quality-standards/ISO-5055/items/CWE-88",
            "standard": "ISO-5055"
        },
        {
            "id": "CWE-78",
            "name": "Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')",
            "href": "AIP/quality-standards/OMG-ASCQM/items/CWE-78",
            "standard": "OMG-ASCQM"
        },
        {
            "id": "CWE-88",
            "name": "Improper Neutralization of Argument Delimiters in a Command ('Argument Injection')",
            "href": "AIP/quality-standards/OMG-ASCQM/items/CWE-88",
            "standard": "OMG-ASCQM"
        },
        {
            "id": "A1-2013",
            "name": "Injection",
            "href": "AIP/quality-standards/OWASP/items/A1-2013",
            "standard": "OWASP"
        },
        {
            "id": "A1-2017",
            "name": "Injection",
            "href": "AIP/quality-standards/OWASP/items/A1-2017",
            "standard": "OWASP"
        },
        {
            "id": "A03-2021",
            "name": "Injection",
            "href": "AIP/quality-standards/OWASP/items/A03-2021",
            "standard": "OWASP"
        },
        {
            "id": "PCI-Requirement-6.5.1",
            "name": "Injection flaws, particularly SQL injection",
            "href": "AIP/quality-standards/PCI-DSS-V3.1/items/PCI-Requirement-6.5.1",
            "standard": "PCI-DSS-V3.1"
        },
        {
            "id": "PCI-Requirement-6.5.1",
            "name": "Injection flaws, particularly SQL injection",
            "href": "AIP/quality-standards/PCI-DSS-V3.2.1/items/PCI-Requirement-6.5.1",
            "standard": "PCI-DSS-V3.2.1"
        },
        {
            "id": "PCI-DSS4-Requirement-6.2.4",
            "name": "Software engineering techniques or other methods are defined and in use by software development personnel to prevent or mitigate common software attacks and related vulnerabilities",
            "href": "AIP/quality-standards/PCI-DSS-V4/items/PCI-DSS4-Requirement-6.2.4",
            "standard": "PCI-DSS-V4"
        },
        {
            "id": "STIG-V-222604",
            "name": "The application must protect from command injection.",
            "href": "AIP/quality-standards/STIG-V5/items/STIG-V-222604",
            "standard": "STIG-V5"
        },
        {
            "id": "STIG-V-222604",
            "name": "The application must protect from command injection.",
            "href": "AIP/quality-standards/STIG-V6/items/STIG-V-222604",
            "standard": "STIG-V6"
        }
    ],
    "parameters": [
        
    ],
    "thresholds": [
        98.0,
        99.0,
        99.5,
        99.99
    ]
}
