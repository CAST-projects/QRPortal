{
    "id": 1019408,
    "name": "Avoid using ToList() / ToArray() before applying further LINQ operators",
    "href": "AIP/quality-rules/1019408",
    "critical": true,
    "severity": 20,
    "maxWeight": 7,
    "extension": {
        "name": "com.castsoftware.entity",
        "href": "AIP/extensions/com.castsoftware.entity"
    },
    "associatedValueName": "Number of violation occurrences",
    "description": "This rule will check the use of ToList() and ToArray() before LINQ operators \n\n%%% MUST ADD THE LIST OF OPERATORS from the Note %%%",
    "output": "Associated to each violation, the following information is provided:\n- The number of violation occurrences\n- Bookmarks for violation occurrences found in the source code",
    "rationale": "Calling .ToList() or .ToArray() materializes the query immediately, executing it and loading all results into memory. Applying additional LINQ operators after that (e.g., .Where(), .Select(), .OrderBy()) causes:\n\nUnnecessary memory usage\nLoss of deferred execution and query optimization\nPerformance bottlenecks with large datasets\nInstead, you should:\n\nDefer execution using .AsEnumerable() if you need to switch from LINQ to Entities to LINQ to Objects\nAvoid materialization until absolutely necessary (e.g., at the end of the query chain)",
    "reference": "https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/ef/language-reference/queryable-and-enumerable-operators\nhttps://learn.microsoft.com/en-us/ef/core/performance/query-performance#avoid-premature-query-execution\nhttps://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca1862\n\nMicrosft Entity Framework - Efficient Querying - Buffering and streaming\nhttps://learn.microsoft.com/en-us/ef/core/performance/efficient-querying#buffering-and-streaming\n\nLINQ Stinks - code smells in your LINQ - LINQ Stink #2 - Reading too much\nhttps://www.markheath.net/post/linq-stinks\n\nEnhancing Database Query Performance with Entity Framework Core: Real-world Examples and Performance Metrics\nExample 3: Query Projection for Minimizing Data Transfer\nhttps://mohamed-hendawy.medium.com/enhancing-database-query-performance-with-entity-framework-core-real-world-examples-and-3899f285e67c",
    "remediation": "Apply further filtering/sorting operations before calling .ToList() or .ToArray().\nUse .AsEnumerable() only when switching to in-memory LINQ processing is intentional.",
    "remediationSample": "using System.Linq;\n\n// ...\n\n// Execute filters in SQL before materializing\nvar data = dbContext.Users\n               .Where(u => u.IsActive)\n               .OrderBy(u => u.Name)\n               .ToList();                 // \u2713 FIXED: materialize after filtering/sorting\n\n\n// If switching to LINQ-to-Objects explicitly\n\nvar data = dbContext.Users\n               .Where(u => u.IsActive)\n               .AsEnumerable()            // \u2713 FIXED : switch to in-memory for complex logic\n               .Where(u => SomeCustomFilter(u));",
    "sample": "using System.Linq;\n\n// ...\n\nvar data = dbContext.Users.ToList()       // \u26a0\ufe0f VIOLATION: query executes here\n               .Where(u => u.IsActive)\n               .OrderBy(u => u.Name);\n\n// This loads all users into memory before filtering and sorting \u2014 a waste of resources if the dataset is large",
    "alternativeName": "Avoid using ToList() / ToArray() before applying further LINQ operators",
    "businessCriteria": [
        {
            "id": 60014,
            "name": "Efficiency",
            "href": "AIP/business-criteria/60014"
        },
        {
            "id": 20140522,
            "name": "Green",
            "href": "AIP/business-criteria/20140522"
        },
        {
            "id": 66031,
            "name": "Programming Practices",
            "href": "AIP/business-criteria/66031"
        }
    ],
    "technicalCriteria": [
        {
            "id": 61019,
            "name": "Efficiency - SQL and Data Handling Performance",
            "href": "AIP/technical-criteria/61019",
            "weight": 7,
            "critical": true
        }
    ],
    "technologies": [
        {
            "id": 138383,
            "name": "C#",
            "href": "AIP/technologies/138383"
        }
    ],
    "qualityStandards": [
        
    ],
    "parameters": [
        
    ],
    "thresholds": [
        0.0,
        0.0,
        0.0,
        0.0
    ]
}
